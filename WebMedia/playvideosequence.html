<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<style>
.video-player {
    border:1px solid black;
    overflow:hidden;
    height:200px;
    background: #edeae8;
    position:relative;
}
.audio-player {
    border:1px solid blue;
    overflow:hidden;
    height:200px;
    background: #edeae8;
    position:relative;
}
.video {
    position:absolute;
    top:0px;
    left:0px;
    width: 100%;
    transition: opacity 1s;
    opacity:0;
    border:1px solid red;
}
.bild {
    position:absolute;
    top:0px;
    left:0px;
    width: 100%;
    transition: opacity 1s;
    opacity:0;
    border:1px solid red;
}
.audio {
    position:absolute;
    top:0px;
    left:0px;
    width: 100%;
    border:1px solid red;
}
</style>
</head>
<body>

<div>
    <button id="play">Play</button>
    <button id="hide">Hide</button>
    <button id="show">Show</button>
    <button id="showall1">Show all videos</button>
    <button id="showall2">Show all images</button>
    <button id="showall3">Show all audio</button>
</div>

<div class="video-player" align="center">
    <video id="video1" src="media/film-1.mp4" class="video"></video>
    <video id="video2" src="media/film-2.mp4" class="video"></video>
    <video id="video3" src="media/film-3.mp4" class="video"></video>
</div>

<div class="video-player" align="center">
    <img id="bild1" src="media/bild-1.jpg" class="bild"></img>
    <img id="bild2" src="media/bild-2.jpg" class="bild"></img>
    <img id="bild3" src="media/bild-3.jpg" class="bild"></img>    
</div>

<div class="audio-player" align="center" copntrols>
    <audio id="audio1" src="media/audio-1.mp3" class="audio" type="audio/mpeg"></audio>
    <audio id="audio2" src="media/audio-2.mp3" class="audio" type="audio/mpeg"></audio>
    <audio id="audio3" src="media/audio-3.mp3" class="audio" type="audio/mpeg"></audio>
</div>


<script src="scripts/jquery-3.1.1.js"></script>

<script>
var videos = [
    { id: "video1", mediaIn: 0, mediaOut: 10000, lengthMin: 2000, lengthMax: 10000},
    { id: "video2", mediaIn: 0, mediaOut: 10000, lengthMin: 2000, lengthMax: 10000},
    { id: "video3", mediaIn: 0, mediaOut: 10000, lengthMin: 2000, lengthMax: 10000}
];
var images = [
    { id: "bild1", mediaIn: 0, mediaOut: 0, lengthMin: 2000, lengthMax: 10000},
    { id: "bild2", mediaIn: 0, mediaOut: 0, lengthMin: 2000, lengthMax: 10000},
    { id: "bild3", mediaIn: 0, mediaOut: 0, lengthMin: 2000, lengthMax: 10000}
];
var audio = [
    { id: "audio1", mediaIn: 0, mediaOut: 10000, lengthMin: 2000, lengthMax: 10000},
    { id: "audio3", mediaIn: 0, mediaOut: 10000, lengthMin: 2000, lengthMax: 10000},
    { id: "audio2", mediaIn: 0, mediaOut: 10000, lengthMin: 2000, lengthMax: 10000}
];

function getPlaybackInterval(mediaIn, mediaOut, lengthMin, lengthMax)
{
    console.log("getPlaybackInterval(" + mediaIn + ", " + mediaOut + ", " + lengthMin + ", " + lengthMax + ")");
    var intervalStart = Math.random()*(mediaOut-mediaIn) + mediaIn;
    var intervalLength = Math.random()*(lengthMax-lengthMin) + lengthMin;
    if (intervalStart+intervalLength > mediaOut) {
        intervalStart = intervalStart - (intervalStart+intervalLength-mediaOut);
    }
    console.log("=> start:" + intervalStart + ", length:" + intervalLength);
    var interval = { start: intervalStart, length: intervalLength };
    return interval;
}

function max(a, b)
{
    if (a>b) {
        return a;
    } else {
        return b;
    }
}

document.getElementById("play").onclick = function() {
    document.getElementById(videos[0].id).play();
}
document.getElementById("hide").onclick = function() { 
    document.getElementById(videos[0].id).style.opacity = 0;
};
document.getElementById("show").onclick = function() { 
    document.getElementById(videos[0].id).style.opacity = 0.95
};
document.getElementById("showall1").onclick = function() {
    perekskog.playAnimateOpacity("videos", videos, 1000, false);
};
document.getElementById("showall2").onclick = function() {
    perekskog.playAnimateOpacity("images", images, 1000, true);
};
document.getElementById("showall3").onclick = function() {
//    var x = new PlayerChangeVolume("audio", audio, 1000);
//    x.play();
    playAnimateVolume("audio", audio, 1000, true);
}



class PlayerChangeOpacity
{
    constructor(id, media, transition) {
        this.id = id;
        this.media = media;
        this.transition = transition;
    };

    play() {
        console.log("x.Play the anim");
        playAnimateOpacity1(this.media, 0, this.transitionLength, false);        
    };
};

class PlayerChangeVolume
{
    constructor(id, media, transition) {
        this.id = id;
        this.media = media;
        this.transition = transition;
    };

    play() {
        console.log("x.Play the anim");
        playAnimateVolume(this.id, this.media, this.transitionLength, false);        
    };
};



var perekskog = {

playAnimateOpacity: function(sequencename, media, transitionLength, random) {
    perekskog.playAnimateOpacity1(media, 0, transitionLength, random);
},

playAnimateOpacity1: function(media, index, transitionLength, random) {
    e = document.getElementById(media[index].id);
    interval = getPlaybackInterval(media[index].mediaIn, media[index].mediaOut, media[index].lengthMin, media[index].lengthMax)
    length = max(transitionLength, interval.length);
    e.style.opacity = 0.95;
    // Check if has class "video", then play it:
    if($(e).hasClass("video"))
        e.play();
        e.currentTime = interval.start / 1000;
    setTimeout(function() { 
        perekskog.playAnimateOpacity2(media, index, transitionLength, random); 
    }, length-transitionLength);
},

playAnimateOpacity2: function(media, index, transitionLength, random) {
    e = document.getElementById(media[index].id)
    e.style.opacity = 0.0;

    if(random==true) {
        index = Math.floor(Math.random() * media.length);
    } else {
        if (index < media.length-1) {
            index = index + 1;
        } else {
            index = 0;
        }
    }
    console.log("Next image/video index = " + index);
    
    setTimeout(function() { 
        perekskog.playAnimateOpacity1(media, index, transitionLength, random); 
    }, transitionLength/2);
}
};




function playAnimateVolume(sequencename, media, transitionLength, random) {
    playAnimateVolume1(media, 0, transitionLength, random);
}

function playAnimateVolume1(media, index, transitionLength, random) {
    e = document.getElementById(media[index].id);
    e.volume = 0;
    interval = getPlaybackInterval(media[index].mediaIn, media[index].mediaOut, media[index].lengthMin, media[index].lengthMax)
    length = max(transitionLength, interval.length);
    e.pause()
    e.currentTime = interval.start
    e.play();
    $(e).animate({volume: 0.95}, transitionLength);
    setTimeout(function() { 
        playAnimateVolume2(media, index, transitionLength, random); 
    }, length-transitionLength);
}

function playAnimateVolume2(media, index, transitionLength, random) {
    e = document.getElementById(media[index].id)
    $(e).animate({volume: 0.0}, transitionLength);
    if(random==true) {
        index = Math.floor(Math.random() * media.length);
    } else {
        if (index < media.length-1) {
            index = index + 1;
        } else {
            index = 0;
        }
    }
    console.log("Next audio index = " + index);

    setTimeout(function() { 
        playAnimateVolume1(media, index, transitionLength, random);
    }, transitionLength/2);
}


</script>

</body>
</html>
